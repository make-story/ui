/* 2016-06-29 Copyright (c) Sung-min Yu. */ !function(a,b){"use strict";return!("undefined"==typeof b||b!==window||!(b.api&&b.api.dom||b.jQuery))&&void(b.api.editor=a(b,b.jQuery||b.api.dom))}(function(a,b,c){"use strict";var d=-200,e={};a.api&&a.api.env?e=a.api.env:(e={check:{touch:"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0},event:{down:"mousedown",move:"mousemove",up:"mouseup",click:"click"}},e.check.touch===!0&&(e.event.down="touchstart",e.event.move="touchmove",e.event.up="touchend",e.event.click=window.DocumentTouch&&document instanceof DocumentTouch?"tap":"click"));var f,g,h={text:{tooltip:c,buttons:{element:c},options:{element:c,link:{}}},image:{tooltip:c,buttons:c,options:c}},i=!1,j=function(a,b,c){var d;if(a)for(;a.parentNode;){if(b(a)&&(d=c(a),"undefined"!=typeof d))return d;a=a.parentNode}},k=function(a){"object"==typeof f&&"rangeCount"in f&&f.rangeCount>0&&(j(f.focusNode,function(b){return b.nodeName.toLowerCase()===a},function(a){return a})?(document.execCommand("formatBlock",!1,"p"),document.execCommand("outdent")):document.execCommand("formatBlock",!1,a))},l=function(a){var b;if("object"==typeof f&&"rangeCount"in f&&f.rangeCount>0){for(b in h.text.buttons)"element"!==b&&(h.text.buttons[b].style.color="rgb(20, 29, 37)",h.text.buttons[b].style.background="none");j(f.focusNode,function(a){return"undefined"!=typeof a.nodeName&&"undefined"!=typeof a.style},function(a){switch(""===a.style.color,a.nodeName.toLowerCase()){case"b":case"strong":h.text.buttons.bold.style.color="rgb(255, 255, 255)",h.text.buttons.bold.style.backgroundColor="rgb(226, 69, 69)";break;case"i":case"em":h.text.buttons.italic.style.color="rgb(255, 255, 255)",h.text.buttons.italic.style.backgroundColor="rgb(226, 69, 69)";break;case"strike":h.text.buttons.strikethrough.style.color="rgb(255, 255, 255)",h.text.buttons.strikethrough.style.backgroundColor="rgb(226, 69, 69)";break;case"u":h.text.buttons.underline.style.color="rgb(255, 255, 255)",h.text.buttons.underline.style.backgroundColor="rgb(226, 69, 69)";break;case"h1":h.text.buttons.h1.style.color="rgb(255, 255, 255)",h.text.buttons.h1.style.backgroundColor="rgb(226, 69, 69)";break;case"h2":h.text.buttons.h2.style.color="rgb(255, 255, 255)",h.text.buttons.h2.style.backgroundColor="rgb(226, 69, 69)";break;case"h3":h.text.buttons.h3.style.color="rgb(255, 255, 255)",h.text.buttons.h3.style.backgroundColor="rgb(226, 69, 69)";break;case"blockquote":h.text.buttons.blockquote.style.color="rgb(255, 255, 255)",h.text.buttons.blockquote.style.backgroundColor="rgb(226, 69, 69)";break;case"a":h.text.buttons.createLink.style.color="rgb(255, 255, 255)",h.text.buttons.createLink.style.backgroundColor="rgb(226, 69, 69)"}})}},m=function(a){var b,c,e,g,i;"object"!=typeof f||f.isCollapsed?(h.text.tooltip.style.top=d+"px",h.text.tooltip.style.left=d+"px"):f.rangeCount>0&&(c=h.text.tooltip.offsetWidth,e=h.text.tooltip.offsetHeight,b=f.getRangeAt(0).getBoundingClientRect(),g=b.top-e-5,g<0?(g=b.bottom+5,h.text.tooltip.style.borderTop="1px solid rgb(226, 69, 69)",h.text.tooltip.style.borderBottom="none"):(h.text.tooltip.style.borderBottom="1px solid rgb(226, 69, 69)",h.text.tooltip.style.borderTop="none"),g+=window.pageYOffset,i=Math.round((b.left+b.right)/2),i-=Math.floor(c/2),i<0?i=0:i+c>Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)&&(i-=i+c-Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)),h.text.tooltip.style.top=g+"px",h.text.tooltip.style.left=i+"px")},n=function(a){var a=a||window.event,b=a&&(a.target||a.srcElement);a.stopPropagation(),f=c,"object"==typeof b&&"isContentEditable"in b&&b.isContentEditable&&i===!1&&(f=window.getSelection(),l()),m()},o=function(a){var a=a||window.event,b=a&&(a.target||a.srcElement),c=b.storage.editor;if(a.preventDefault(),a.stopPropagation(),"object"==typeof f&&"rangeCount"in f&&f.rangeCount>0)switch(c){case"bold":f.anchorNode&&!j(f.anchorNode,function(a){return/^(h1|h2|h3)$/i.test(a.nodeName.toLowerCase())},function(a){return!0})&&document.execCommand("bold",!1);break;case"italic":document.execCommand("italic",!1);break;case"strikethrough":document.execCommand("strikethrough",!1);break;case"underline":document.execCommand("underline",!1);break;case"h1":case"h2":case"h3":f.focusNode&&!j(f.focusNode,function(a){return/^(b|strong)$/i.test(a.nodeName.toLowerCase())},function(a){return!0})&&k(c);break;case"blockquote":k(c);break;case"createLink":h.text.options.link.element.style.display="block",setTimeout(function(){var a=j(f.focusNode,function(a){return"undefined"!=typeof a.href},function(a){return a.href});"undefined"!=typeof a?h.text.options.link["link-input"].value=a:document.execCommand("createLink",!1,"#none"),g=f.getRangeAt(0),h.text.options.link["link-input"].focus()},100)}},p=function(a){var a=a||window.event;a&&(a.target||a.srcElement);a.preventDefault(),a.stopPropagation(),setTimeout(function(){l(),m()},1)},q=function(a){var b=h.text.options.link["link-input"].value;window.getSelection().addRange(g),document.execCommand("unlink",!1),""!==b&&(b.match("^(http|https)://")||(b="http://"+b),document.execCommand("createLink",!1,b)),h.text.options.link["link-input"].value="",h.text.options.link.element.style.display="none",l()},r=function(a){13===a.keyCode&&(a.preventDefault(),h.text.options.link["link-input"].blur())},s=function(a){var b,c,d=window.getSelection();"object"==typeof d&&d.anchorNode&&(b=j(d.anchorNode,function(a){return"p"===a.nodeName.toLowerCase()},function(a){return a}),13===a.keyCode&&b&&(c=b.previousSibling,c&&"HR"===c.nodeName&&!c.textContent.length&&a.preventDefault()))},t=function(a){n(a),"object"==typeof f&&f.anchorNode&&13===a.keyCode&&"DIV"===f.anchorNode.nodeName&&k("p")},u=function(a){var c,d,f=function(a){if("object"!=typeof a.storage)a.storage={};else if(a.storage.EVENT_MOUSEUP_editor||a.storage.EVENT_KEYDOWN_editor||a.storage.EVENT_KEYUP_editor)return!0;a.isContentEditable||(a.contentEditable=!0),b(a).on(e.event.up+".EVENT_MOUSEUP_editor",n),b(a).on("keydown.EVENT_KEYDOWN_editor",s),b(a).on("keyup.EVENT_KEYUP_editor",t)};if(!a&&(a=document.querySelectorAll('[contenteditable="true"]'),!a.length))return!1;if(a.nodeType)f(a);else for(c=0,d=a.length;c<d;c++)f(a[c]);b(document).on("compositionstart.EVENT_COMPOSITIONSTART_editor",function(){i=!0}),b(document).on("compositionend.EVENT_COMPOSITIONEND_editor",function(){i=!1})},v=function(a){a&&a.length||(a=document.querySelectorAll('[contenteditable="true"]'));var c,d,e;for(c=0,d=a.length;c<d;c++)e=a[c],"object"==typeof e.storage&&(b(e).off(".EVENT_MOUSEUP_editor"),b(e).off(".EVENT_KEYDOWN_editor"),b(e).off(".EVENT_KEYUP_editor"));b(document).off(".EVENT_MOUSEUP_editor_document"),b(document).off(".EVENT_COMPOSITIONSTART_editor"),b(document).off(".EVENT_COMPOSITIONEND_editor")},w=function(a){var a=a||{},b=a.tag,c=a.editor,d=document.createElement(b);if(d.storage={editor:c},h.text.buttons[c])return d;switch("button"===b&&(h.text.buttons[c]=d,d.style.cssText="padding: 0px; width: 30px; height: 30px; font-size: 14px; color: rgb(20, 29, 37); background: none; border: 0px; outline: none; cursor: pointer; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;",d.onmousedown=o,d.onmouseup=p),c){case"bold":d.textContent="B",d.style.fontWeight="bold";break;case"italic":d.textContent="I",d.style.fontStyle="italic";break;case"strikethrough":d.textContent="S",d.style.textDecoration="line-through";break;case"underline":d.textContent="U",d.style.textDecoration="underline";break;case"h1":d.textContent="H1";break;case"h2":d.textContent="H2";break;case"h3":d.textContent="H3";break;case"blockquote":d.textContent='"';break;case"createLink":d.textContent="#",h.text.options.link.element=document.createElement("div"),h.text.options.link["link-input"]=document.createElement("input"),h.text.options.link.element.appendChild(h.text.options.link["link-input"]),h.text.options.element.appendChild(h.text.options.link.element),h.text.options.link.element.style.cssText="display: none;",h.text.options.link["link-input"].onblur=q,h.text.options.link["link-input"].onkeydown=r;break;case"InsertImage":}return d};return function(){var a=document.createDocumentFragment();h.text.tooltip=document.createElement("div"),h.text.tooltip.style.cssText="transition: all .3s ease; position: absolute; top: "+d+"px; left: "+d+"px; color: rgb(20, 29, 37); background-color: rgba(255, 255, 255, 0.87);",h.text.buttons.element=document.createElement("div"),h.text.options.element=document.createElement("div"),h.text.tooltip.appendChild(h.text.buttons.element),h.text.tooltip.appendChild(h.text.options.element),a.appendChild(h.text.tooltip),h.text.buttons.element.appendChild(w({tag:"button",editor:"h1"})),h.text.buttons.element.appendChild(w({tag:"button",editor:"h2"})),h.text.buttons.element.appendChild(w({tag:"button",editor:"h3"})),h.text.buttons.element.appendChild(w({tag:"button",editor:"bold"})),h.text.buttons.element.appendChild(w({tag:"button",editor:"italic"})),h.text.buttons.element.appendChild(w({tag:"button",editor:"strikethrough"})),h.text.buttons.element.appendChild(w({tag:"button",editor:"underline"})),h.text.buttons.element.appendChild(w({tag:"button",editor:"blockquote"})),h.text.buttons.element.appendChild(w({tag:"button",editor:"createLink"})),document.body.appendChild(a)}(),{on:u,off:v}},this);