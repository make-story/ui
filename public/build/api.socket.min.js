/* 2016-06-29 Copyright (c) Sung-min Yu. */ !function(a,b){"use strict";return"undefined"!=typeof b&&b===window&&(b.api||(b.api={}),void(b.api.socket=a(b)))}(function(a,b){"use strict";var c={};return function(a){if(!a.url)return!1;if("object"==typeof c[a.url])return c[a.url];var b,d=[],e=function(a){var c,d=this;d.settings={url:"",callback:{open:null,message:null,close:null,error:null}},c=function e(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(b[c]&&b[c].constructor===Object&&!b[c].nodeType?(a[c]=a[c]||{},a[c]=e(a[c],b[c])):a[c]=b[c]);return a},d.settings=c(d.settings,a),d.settings.url=/^ws:\/\//.test(d.settings.url)?d.settings.url:"ws://"+d.settings.url,b=new WebSocket(d.settings.url),b.onopen=function(){d.send(),"function"==typeof d.settings.callback.open&&d.settings.callback.open.call(d,Array.prototype.slice.call(arguments))},b.onmessage=function(a){"function"==typeof d.settings.callback.message&&d.settings.callback.message.call(d,a.data)},b.onclose=function(a){a.code,a.reason,a.wasClean;"function"==typeof d.settings.callback.close&&d.settings.callback.close.call(d,Array.prototype.slice.call(arguments))},b.onerror=function(){"function"==typeof d.settings.callback.error&&d.settings.callback.error.call(d,Array.prototype.slice.call(arguments))}};return e.prototype={send:function(a){var c=this;switch(a&&d.push(a),b.readyState){case 0:case 2:case 3:break;case 1:for(;d.length;)b.send(d.shift())}return c},close:function(){var a=this;return"object"==typeof b&&b.readyState<=1&&(b.close(),delete c[a.settings.url]),a}},c[a.url]=new e(a)}},this);