/* 2016-06-09 Copyright (c) Sung-min Yu. */ !function(a,b){"use strict";return"undefined"==typeof b||b!==window?!1:(b.api||(b.api={}),void(b.api.socket=a(b)))}(function(a,b){"use strict";var c={},d=function e(a){var b,d=this;if(!a.url)return!1;if("object"==typeof c[a.url])return c[a.url];if(!(this instanceof e))return c[a.url]=new e(a);d.settings={url:"",open:null,close:null,message:null,error:null};for(b in a)a.hasOwnProperty(b)&&(d.settings[b]=a[b]);d.settings.url=/^ws:\/\//.test(d.settings.url)?d.settings.url:"ws://"+d.settings.url,d.queue=[],d.socket,d.open(),"function"==typeof d.settings.message&&d.message(d.settings.message)};return d.prototype={open:function(){var a=this;try{a.socket=new WebSocket(a.settings.url)}catch(b){}return a.socket.onopen=function(){a.send(),"function"==typeof a.settings.open&&a.settings.open.call(a,Array.prototype.slice.call(arguments))},a.socket.onclose=function(b){b.code,b.reason,b.wasClean;"function"==typeof a.settings.close&&a.settings.close.call(a,Array.prototype.slice.call(arguments))},a.socket.onerror=function(){"function"==typeof a.settings.error&&a.settings.error.call(a,Array.prototype.slice.call(arguments))},a},send:function(a){var b=this;switch(a&&b.queue.push(a),b.socket.readyState){case 0:case 2:case 3:break;case 1:for(;b.queue.length;)b.socket.send(b.queue.shift())}return b},message:function(a){var b=this;return"function"==typeof a&&(b.socket.onmessage=function(b){a.call(this,b.data)}),b},close:function(){var a=this;return"object"==typeof a.socket&&a.socket.readyState<=1&&(a.socket.close(),delete c[a.settings.url]),a}},d},this);