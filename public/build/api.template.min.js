/* 2016-06-22 Copyright (c) Sung-min Yu. */ !function(a,b){"use strict";return"undefined"!=typeof b&&b===window&&(b.api||(b.api={}),void(b.api.template=a(b)))}(function(a,b){"use strict";a.debug||(a.debug={log:function(a,b){"undefined"==typeof b?console.log("----------【 "+a+" 】"):(console.log("----------【 "+a),console.log(b),console.log("---------- 】"))},dir:function(a,b){"undefined"==typeof b?(console.log("----------【"),console.dir(a),console.log("---------- 】")):(console.log("----------【 "+a),console.dir(b),console.log("---------- 】"))}});var c=function(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},d={tag:{open:new RegExp(c("{{")+"\\s*"),close:new RegExp("\\s*"+c("}}"))},type:{variable:new RegExp("^[=|\\s*=|=\\s*](\\S+)"),context_open:new RegExp("^[<|\\s*<|<\\s*](\\S+)"),context_close:new RegExp("(\\S+)[>|\\s*>|>\\s*]$")}},e=function i(a,b,e){this.template=a||"",this.context=b||"global",this.parent=e||null,this.tree=[];for(var f,g,h,j,k,l;""!==this.template;)f=this.template.match(d.tag.open),g=this.template.match(d.tag.close),f?(k="",l=this.template.substring(0,f.index),g?(k=this.template.substring(f.index+f[0].length,g.index),this.template=this.template.substring(g.index+g[0].length)):this.template=this.template.substring(f.index+f[0].length)):(k="",l=this.template,this.template=""),this.tree.push({type:"code",value:l}),d.type.variable.test(k)?(h=k.match(d.type.variable),h&&this.tree.push({type:"variable",value:h[1]})):d.type.context_open.test(k)&&(h=k.match(d.type.context_open),h&&(j=this.template.match(new RegExp(c("{{")+h[1]+"[>|\\s*>|>\\s*]"+c("}}"))),j&&(this.tree.push({type:"context",value:new i(this.template.substring(0,j.index),h[1],this)}),this.template=this.template.substring(j[0].length+j.index))))},f=function j(a,b){var c,d,e,f,g,h,i=a.tree||[],b=b||{},k=[];for(c=0,d=i.length;c<d;c++)if("type"in i[c]&&"value"in i[c])switch(i[c].type){case"variable":if(g=b[i[c].value],!g)continue;if("function"==typeof g)k.push({type:"code",value:g.call(b)});else if(Array.isArray(g))for(e=0,f=g.length;e<f;e++)k.push({type:"code",value:g[e]});else k.push({type:"code",value:b[i[c].value]});break;case"context":if(g=b[i[c].value.context],!g)continue;if("function"==typeof g)h=j(i[c].value,g.call(b)),k=k.concat(h);else if(Array.isArray(g))for(e=0,f=g.length;e<f;e++)h=j(i[c].value,g[e]),k=k.concat(h);else"object"==typeof g&&(h=j(i[c].value,g),k=k.concat(h));break;default:k.push(i[c])}return k},g=function(a){var b,c,d=[];for(b=0,c=a.length;b<c;b++)"code"===a[b].type&&d.push(a[b].value);return d.join("")},h=function(){this.cache={}};return h.prototype={parse:function(a){return this.cache[a]||(this.cache[a]=new e(a)),this.cache[a]},render:function(a,b){var c=this.cache[a];return c||(c=this.parse(a)),f(c,b)},paint:function(a,b){var c=this.render(a,b);return g(c)}},new h},this);